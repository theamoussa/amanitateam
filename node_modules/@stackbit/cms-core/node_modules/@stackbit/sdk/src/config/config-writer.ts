import path from 'path';
import fse from 'fs-extra';
import yaml from 'js-yaml';

import { Config } from './config-types';
import { convertToYamlConfig } from './config-loader-utils';

const packageJson = require('../../package.json');

export interface WriteConfigOptions {
    dirPath: string;
    config: Config;
}

export async function writeConfig({ dirPath, config }: WriteConfigOptions) {
    const yamlConfig = convertToYamlConfig({ config });
    const filePath = path.join(dirPath, 'stackbit.yaml');
    const yamlString = yaml.dump(yamlConfig);
    const info =
        `# This file was generated by @stackbit/sdk v${packageJson.version}\n` +
        '# To learn more about stackbit.yaml please visit https://www.stackbit.com/docs/stackbit-yaml/\n';
    const data = info + yamlString;
    await fse.outputFile(filePath, data);
}
